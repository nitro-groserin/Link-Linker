<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>ãƒªãƒ³ã‚¯ãƒªãƒ³ã‚«ãƒ¼</title>
    <style>
        /* ========================================================= */
        /* CSS (ãƒ‡ã‚¶ã‚¤ãƒ³) ã‚»ã‚¯ã‚·ãƒ§ãƒ³ - çœç•¥ã›ãšå…¨ã¦å«ã¿ã¾ã™ */
        /* ========================================================= */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #fce4ec;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 20px; 
            margin: 0; 
            min-height: 100vh;
        }

        .container {
            background-color: #ffffff;
            padding: 20px 15px; 
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 95%; 
            max-width: 420px;
            box-sizing: border-box; 
        }

        h1 {
            color: #d32f2f;
            font-size: 1.8em; 
            margin-bottom: 20px;
            text-align: center;
        }

        .input-group {
            display: flex;
            gap: 8px; 
            margin-bottom: 15px;
            flex-direction: column; 
        }
        
        .input-group input[type="text"] {
            padding: 10px; 
            border: 2px solid #ccc;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 1em;
            width: 100%; 
            transition: border-color 0.3s;
        }

        .input-group input[type="text"]:focus {
            border-color: #d32f2f;
            outline: none;
        }

        button {
            padding: 10px 15px; 
            background-color: #d32f2f;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s, box-shadow 0.3s;
            width: 100%; 
            box-sizing: border-box;
            margin-top: 5px;
        }

        button:hover:not(:disabled) {
            background-color: #b71c1c;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
        }

        button:disabled {
            background-color: #ffcdd2;
            color: #d32f2f;
            cursor: not-allowed;
        }

        @media (min-width: 501px) {
            .input-group {
                flex-direction: row; 
                gap: 10px;
            }

            .input-group input[type="text"] {
                flex-grow: 1;
                width: auto;
            }
            
            #urlInput {
                flex-grow: 3;
            }

            #linkNameInput {
                flex-grow: 2;
            }

            .input-group button { 
                width: auto;
                min-width: 80px;
            }
        }
        
        /* ãã®ä»–ã®å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        .sample-url {
            margin-top: 20px;
            padding: 15px 0;
            text-align: center;
            color: #666;
            font-size: 0.9em;
            border-top: 1px dashed #ffcdd2; 
            padding-top: 15px;
        }
        .sample-url p {
            font-weight: bold;
            color: #d32f2f;
            margin-bottom: 8px;
        }
        .sample-url a {
            color: #333; 
            text-decoration: none;
            word-break: break-all;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            border: 1px solid #ffcdd2;
            border-radius: 8px;
            background-color: #ffebee;
            padding: 10px 15px; 
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
            margin: 0 auto;
            max-width: 100%;
            position: relative; 
        }
        #resultContainer {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            min-height: 50px;
        }
        
        #resultContainer > p {
            font-weight: bold;
            color: #555;
            margin-bottom: 15px;
        }
        /* ãƒªãƒ³ã‚¯ãƒªã‚¹ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .generated-links {
            display: flex;
            flex-direction: column;
            gap: 8px; 
            min-height: 200px; 
        }
        .generated-links a {
            display: flex;
            flex-direction: column; 
            align-items: flex-start;
            padding: 10px 15px; 
            background-color: #ffebee;
            color: #333; 
            text-decoration: none;
            border-radius: 8px;
            border: 1px solid #ffcdd2;
            transition: background-color 0.3s, transform 0.2s, opacity 0.5s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
            position: relative; 
        }
        .link-name {
            font-weight: bold;
            color: #333;
            max-width: 100%;
            margin-bottom: 3px; 
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        .link-url {
            font-size: 0.85em; 
            color: #d32f2f;
            max-width: 100%;
            word-break: break-all;
            text-align: left;
        }
        .timer-display {
            font-weight: normal;
            font-size: 0.85em; 
            color: #d32f2f;
            margin-left: 8px; 
            white-space: nowrap;
        }
        .app-footer {
            margin-top: 25px; 
            padding: 10px 0;
            color: black; 
            font-size: 0.8em;
            text-align: center;
            width: 95%; 
            max-width: 420px;
            box-sizing: border-box;
            border-top: 1px solid #ffcdd2; 
        }
        /* â˜…ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¡ãƒ¢æ©Ÿèƒ½ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¤‰æ›´ã«ä¼´ã†CSSè¿½åŠ  */
        .memo-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        #saveMemoButton {
            flex-grow: 1;
            margin-top: 0;
        }
        #clearMemoButton {
            flex-grow: 1;
            margin-top: 0;
            background-color: #757575; 
        }
        #clearMemoButton:hover:not(:disabled) {
            background-color: #424242;
        }
        #savedMemoDisplay {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            box-sizing: border-box;
            border: 1px solid #ffcdd2;
            border-radius: 8px;
            background-color: #f8f8f8; /* ä¿å­˜ã‚¹ãƒšãƒ¼ã‚¹ã®èƒŒæ™¯ã‚’å°‘ã—å¤‰ãˆã‚‹ */
            white-space: pre-wrap; /* æ”¹è¡Œã‚’åæ˜  */
            overflow-y: auto; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã« */
            margin-bottom: 10px;
            font-size: 1em;
            color: #333;
        }
        #newMemoInput {
            width: 100%; 
            min-height: 80px;
            padding: 10px; 
            box-sizing: border-box; 
            border: 1px solid #ccc; 
            border-radius: 8px; 
            resize: vertical; 
            font-size: 1em;
            margin-bottom: 10px;
        }
        /* ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ç”¨CSSã®è¿½åŠ  */
        .pagination {
            display: flex;
            justify-content: center;
            margin: 15px 0;
            gap: 5px;
        }
        .page-button {
            padding: 5px 10px;
            border: 1px solid #d32f2f;
            border-radius: 5px;
            cursor: pointer;
            background-color: #fff;
            color: #d32f2f;
            font-size: 0.9em;
            transition: background-color 0.2s;
        }
        .page-button.active {
            background-color: #d32f2f;
            color: white;
            font-weight: bold;
        }
        .page-button:hover {
            background-color: #ffcdd2;
        }
    </style>
</head>
<body>


<div style="
    text-align: center;
    border: 2px solid #ff4500; 
    padding: 10px; 
    margin: 15px auto 15px auto; 
    max-width: 400px;
    background-color: #fffaf0;
    border-radius: 8px;
">
    <h3 style="margin-top: 0; color: #ff4500; font-size: 15px;">
        Youtubeã‚„TikTokç­‰ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„<br>
      ğŸ”¥  ä¼šç¤¾ã®å•†å“ç­‰ã‚’æ ¼å®‰ã§å®£ä¼ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ ğŸ”¥
    </h3>
    <p style="font-size: 13px; color: #333; margin-bottom: 5px;">
        ã‚³ãƒãƒ©ã®ã‚¹ãƒšãƒ¼ã‚¹ã«ãƒ‰ã‚«ãƒ³ã¨æ²è¼‰ğŸ’ª<br>
        <strong style="color: #ff4500; font-size: 15px;">
            ã€æ²è¼‰æ–™é‡‘ï¼šä¼æ¥­ãƒ»æœˆé¡30,000å††ã€‘
            <br>
            ã€å€‹äººãƒ»æœˆé¡5,000å††ã€‘
        </strong>
    </p>
    <a href="mail.html" style="
        display: inline-block;
        padding: 5px 15px; 
        background-color: #ff4500;
        color: white;
        text-decoration: none;
        border-radius: 5px;
        font-weight: bold;
        font-size: 13px;
        margin-top: 5px;
    ">
        è©³ç´°ãƒ»ãŠå•ã„åˆã‚ã›ã¯ã“ã¡ã‚‰
    </a>
</div>


    
    <div class="container">
        
        


        
        <h1>ãƒªãƒ³ã‚¯ãƒªãƒ³ã‚«ãƒ¼</h1>

        <div class="input-group">
            <input type="text" id="linkNameInput" placeholder="ãƒªãƒ³ã‚¯ã®åå‰ (ä»»æ„)" size="20">
            <input type="text" id="urlInput" placeholder="URLã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ (https://...)" size="40">
            <button onclick="displayUrl()">è¿½åŠ </button>
        </div>

        <div class="sample-url">
            <p>ğŸ“‹ **ã‚µãƒ³ãƒ—ãƒ«ãƒªãƒ³ã‚¯**</p>
            <a href="https://nitro-groserin.github.io/Brave-Undead-Hero-/" target="_blank">
                <span class="link-name" style="color: #333;">[ãƒ–ãƒ¬ã‚¤ãƒ–ãƒ»ã‚¢ãƒ³ãƒ‡ãƒƒãƒ‰ãƒ»ãƒ’ãƒ¼ãƒ­ãƒ¼]</span>
                <span class="link-url">https://nitro-groserin.github.io/Brave-Undead-Hero-/</span>
            </a>
        </div>

        <div id="resultContainer">
            <p>å…¥åŠ›æ¬„ã«URLã¨åå‰ã‚’è²¼ã‚Šä»˜ã‘ã€ã€Œè¿½åŠ ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚**è¿½åŠ ã•ã‚ŒãŸãƒªãƒ³ã‚¯ã¯10åˆ†å¾Œã«è‡ªå‹•ã§å‰Šé™¤ã•ã‚Œã¾ã™ã€‚**</p>
            
            <div class="pagination" id="paginationContainer">
                </div>

            <div class="generated-links" id="generatedLinksDiv">
            </div>
        </div>

    </div>

    <div style="text-align: center; padding: 5px; margin: 5px auto; max-width: 400px;">
        <a href="https://nitro-groserin.github.io/Yakuza-Slayer">
            <img src="/20251002_135127.jpg" alt="åç¤¾ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼" style="max-width: 100%; height: auto; border: 2px solid #ff4500; border-radius: 8px; background-color: #fffaf0; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);">
        </a>
    </div>
    
    <img src="http://www5.kannet.ne.jp/~counter/count.cgi?name=brave&type=1&width=9">

    <div class="container" id="localMemoContainer" style="margin-top: 20px; padding: 15px;">
        <p style="font-weight: bold; color: #d32f2f; margin-bottom: 10px; text-align: center;">ğŸ’¾ãƒ„ã‚¤ãƒ¡ãƒ¢ (ã‚ãªãŸå°‚ç”¨ãƒ„ã‚¤ãƒ¼ãƒˆ)</p>
        
        <div id="savedMemoDisplay">ä¿å­˜ã•ã‚ŒãŸãƒ„ã‚¤ãƒ¼ãƒˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
        
        <textarea id="newMemoInput" placeholder="æ–°ã—ã„ãƒ„ã‚¤ãƒ¼ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"></textarea>
        
        <div class="memo-buttons">
            <button id="saveMemoButton">ğŸ’¾ ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹</button>
            <button id="clearMemoButton">ğŸ—‘ï¸ æ¶ˆå»ã™ã‚‹</button> 
        </div>
        <p id="memoStatus" style="font-size: 0.9em; color: #777; text-align: center; margin-top: 5px;"></p>
    </div>
    <footer class="app-footer">
        Â© 2025 Link Linker. All rights reserved by æš´é¢¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
    </footer>










<script type="module">
    // 1. Firebase v12ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆå¤‰æ›´ãªã—ï¼‰
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getFirestore, collection, query, where, limit, getDocs, addDoc, onSnapshot, orderBy } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js"; 

    // 2. Firebaseè¨­å®šã¨åˆæœŸåŒ–ï¼ˆå¤‰æ›´ãªã—ï¼‰
    const firebaseConfig = {
        apiKey: "AIzaSyDKt3Ho2JYOsrupclb5uIOTRMFbubuVRNk",
        authDomain: "link-linker.firebaseapp.com",
        projectId: "link-linker",
        storageBucket: "link-linker.firebasestorage.app",
        messagingSenderId: "943254114325",
        appId: "1:943254114325:web:21566b315af94fcbfd3e1c"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app); 
    const auth = getAuth(app); 

    // =========================================================
    // 3. ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆã™ã¹ã¦ã®é–¢æ•°å®šç¾©ã¨å¤‰æ•°ï¼‰
    // =========================================================

    // ãƒªãƒ³ã‚¯ãŒè‡ªå‹•å‰Šé™¤ã•ã‚Œã‚‹ã¾ã§ã®æ™‚é–“ (10åˆ† = 600,000ãƒŸãƒªç§’)
    const DELETE_DELAY_MS = 60 * 360 * 1000;
    // 1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®ãƒªãƒ³ã‚¯æ•°
    const LINKS_PER_PAGE = 10;
    // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¡ãƒ¢ã®ã‚­ãƒ¼
    const LOCAL_MEMO_KEY = 'linklinker_user_memo';

    let allLinks = [];
    let currentPage = 1;

    const resultContainer = document.getElementById('resultContainer');
    const generatedLinksDiv = document.getElementById('generatedLinksDiv');
    const paginationContainer = document.getElementById('paginationContainer');
    const messageElement = resultContainer ? resultContainer.querySelector('p') : null;

    // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¡ãƒ¢é–¢é€£ã®DOMè¦ç´ 
    const savedMemoDisplay = document.getElementById('savedMemoDisplay');
    const newMemoInput = document.getElementById('newMemoInput');
    const saveButton = document.getElementById('saveMemoButton');
    const clearButton = document.getElementById('clearMemoButton');
    const memoStatus = document.getElementById('memoStatus');

    // -----------------------------------------------------
    // éŸ³å£°è¦ç´ ã®å®šç¾© (å¤‰æ›´ãªã—)
    // -----------------------------------------------------
    const saveSound = new Audio('/sound-box/PC-Mouse06-1.mp3'); 
    const clearSound = new Audio('/sound-box/PC-Mouse06-1.mp3'); 
    saveSound.volume = 0.5;
    clearSound.volume = 0.5;

    // -----------------------------------------------------
    // â˜…â˜…â˜… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–é–¢æ•°ï¼ˆXSSå¯¾ç­–ï¼‰ã®è¿½åŠ  â˜…â˜…â˜…
    // -----------------------------------------------------
    /**
     * å…¥åŠ›ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰HTMLã‚¿ã‚°ã‚’ç„¡å®³åŒ–ã—ã€XSSã‚’é˜²ã
     * @param {string} text - ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã™ã‚‹æ–‡å­—åˆ—
     * @returns {string} ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã•ã‚ŒãŸæ–‡å­—åˆ—
     */
    function sanitizeInput(text) {
        if (!text) return '';
        // HTMLç‰¹æ®Šæ–‡å­—ã‚’ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«å¤‰æ›ã—ã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒHTMLã¨ã—ã¦è§£é‡ˆã™ã‚‹ã®ã‚’é˜²ã
        return String(text)
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#39;');
    }
    // -----------------------------------------------------


    // -----------------------------------------------------
    // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¡ãƒ¢ã®ä¿å­˜ã¨èª­ã¿è¾¼ã¿/æ¶ˆå» (å¤‰æ›´ãªã—)
    // -----------------------------------------------------
    function loadLocalMemo() {
        if (!savedMemoDisplay || !newMemoInput) return;

        const savedJson = localStorage.getItem(LOCAL_MEMO_KEY);

        try {
            const savedMemos = savedJson ? JSON.parse(savedJson) : [];

            if (savedMemos.length > 0) {
                savedMemoDisplay.innerHTML = ''; 
                savedMemos.reverse().forEach(memoData => {
                    // â˜… ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¡ãƒ¢ã®è¡¨ç¤ºã«ã‚‚ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã‚’é©ç”¨ã™ã‚‹ã“ã¨ãŒæœ›ã¾ã—ã„ã§ã™ãŒã€
                    //    ã“ã“ã§ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ä¿¡é ¼æ€§ã‚’å‰æã¨ã—ã¦å‡¦ç†ã¯æ®ãˆç½®ãã¾ã™ã€‚
                    appendMemoToDisplay(memoData.content, memoData.timestamp);
                });
                memoStatus.textContent = `${savedMemos.length}ä»¶ã®ãƒ„ã‚¤ãƒ¼ãƒˆãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸã€‚`;
            } else {
                savedMemoDisplay.textContent = 'ã¾ã ãƒ„ã‚¤ãƒ¼ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚';
                memoStatus.textContent = '';
            }

        } catch (e) {
            console.error("ãƒ­ãƒ¼ã‚«ãƒ«ãƒ„ã‚¤ãƒ¼ãƒˆã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ã€‚ãƒ‡ãƒ¼ã‚¿å½¢å¼ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã€‚", e);
            localStorage.removeItem(LOCAL_MEMO_KEY);
            savedMemoDisplay.textContent = 'ãƒ‡ãƒ¼ã‚¿å½¢å¼ãŒä¸æ­£ã§ã—ãŸã€‚ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚';
        }


        if (saveButton) {
            saveButton.addEventListener('click', saveLocalMemo);
        }
        if (clearButton) {
            clearButton.addEventListener('click', clearLocalMemo);
        }
    }

    function appendMemoToDisplay(content, timestamp) {
        if (savedMemoDisplay.textContent === 'ã¾ã ãƒ„ã‚¤ãƒ¼ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚') {
            savedMemoDisplay.innerHTML = '';
        }

        const memoDiv = document.createElement('div');
        memoDiv.style.padding = '8px 10px';
        memoDiv.style.borderBottom = '1px solid #eee';
        memoDiv.style.backgroundColor = '#fff';
        memoDiv.style.borderRadius = '6px';
        memoDiv.style.marginBottom = '5px';
        memoDiv.style.wordBreak = 'break-word';

        const contentP = document.createElement('p');
        contentP.textContent = content; // textContentã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ã€XSSã¯é˜²ã’ã¦ã„ã‚‹
        contentP.style.margin = '0 0 5px 0';
        contentP.style.whiteSpace = 'pre-wrap';
        contentP.style.color = '#333';

        const timeSpan = document.createElement('span');
        const date = new Date(timestamp);
        timeSpan.textContent = `ğŸ“ ${date.toLocaleDateString()} ${date.toLocaleTimeString()}`;
        timeSpan.style.fontSize = '0.8em';
        timeSpan.style.color = '#777';
        timeSpan.style.display = 'block';
        timeSpan.style.textAlign = 'right';

        memoDiv.appendChild(contentP);
        memoDiv.appendChild(timeSpan);

        savedMemoDisplay.prepend(memoDiv);
    }

    function saveLocalMemo() {
        if (newMemoInput) {
            const memoContent = newMemoInput.value.trim();

            if (memoContent === "") {
                memoStatus.textContent = 'âš ï¸ ãƒ„ã‚¤ãƒ¼ãƒˆãŒç©ºã§ã™ã€‚ä½•ã‹å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
                return;
            }
            // â˜… ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¡ãƒ¢ã¸ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã‚’é©ç”¨ (XSSå¯¾ç­–)
            const sanitizedContent = sanitizeInput(memoContent);

            saveButton.disabled = true;
            saveButton.textContent = 'ä¿å­˜ä¸­...';
            clearButton.disabled = true;

            const currentTimestamp = Date.now();
            const newMemoData = {
                content: sanitizedContent, // ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã—ãŸã‚‚ã®ã‚’ä¿å­˜
                timestamp: currentTimestamp
            };

            const savedJson = localStorage.getItem(LOCAL_MEMO_KEY);
            let savedMemos = savedJson ? JSON.parse(savedJson) : [];

            savedMemos.push(newMemoData);

            localStorage.setItem(LOCAL_MEMO_KEY, JSON.stringify(savedMemos));

            appendMemoToDisplay(sanitizedContent, currentTimestamp); // ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã—ãŸã‚‚ã®ã‚’è¡¨ç¤º

            newMemoInput.value = '';

            memoStatus.textContent = `âœ… ãƒ„ã‚¤ãƒ¼ãƒˆãŒ ${new Date(currentTimestamp).toLocaleTimeString()} ã«è¿½åŠ ã•ã‚Œã¾ã—ãŸï¼`;
            saveSound.play().catch(e => console.log("ä¿å­˜éŸ³ã®å†ç”Ÿã«å¤±æ•—:", e)); 

            setTimeout(() => {
                saveButton.disabled = false;
                saveButton.textContent = 'ğŸ’¾ ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹';
                clearButton.disabled = false;
            }, 500);
        }
    }

    function clearLocalMemo() {
        if (confirm("ä¿å­˜ã•ã‚ŒãŸãƒ„ã‚¤ãƒ¼ãƒˆã‚’å®Œå…¨ã«æ¶ˆå»ã—ã¾ã™ã‹ï¼Ÿ")) {
            localStorage.removeItem(LOCAL_MEMO_KEY); 

            savedMemoDisplay.innerHTML = '';
            savedMemoDisplay.textContent = 'ã¾ã ãƒ„ã‚¤ãƒ¼ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚';
            newMemoInput.value = '';

            memoStatus.textContent = 'ğŸ—‘ï¸ ãƒ„ã‚¤ãƒ¼ãƒˆã¯å®Œå…¨ã«æ¶ˆå»ã•ã‚Œã¾ã—ãŸã€‚';
            clearSound.play().catch(e => console.log("æ¶ˆå»éŸ³ã®å†ç”Ÿã«å¤±æ•—:", e)); 
        }
    }

    // -----------------------------------------------------
    // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã¨æç”»é–¢é€£ (å¤‰æ›´ãªã—)
    // -----------------------------------------------------

    function renderPage(pageNum) {
        const totalPages = Math.ceil(allLinks.length / LINKS_PER_PAGE);
        if (pageNum < 1) pageNum = 1;
        if (pageNum > totalPages && totalPages > 0) pageNum = totalPages;

        currentPage = pageNum;

        if (generatedLinksDiv) generatedLinksDiv.innerHTML = '';

        const startIndex = (currentPage - 1) * LINKS_PER_PAGE;
        const endIndex = startIndex + LINKS_PER_PAGE;
        const linksToShow = allLinks.slice(startIndex, endIndex);

        // ãƒªãƒ³ã‚¯ãŒç©ºã®å ´åˆã€å‰ã®ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹
        if (linksToShow.length === 0 && allLinks.length > 0 && currentPage > 1) {
            renderPage(currentPage - 1);
            return;
        }

        linksToShow.forEach(linkData => {
            const linkElement = createLinkElement(linkData);
            if (generatedLinksDiv) generatedLinksDiv.appendChild(linkElement);

            const timerDisplay = linkElement.querySelector('.timer-display');
            if (timerDisplay) {
                const remaining = linkData.expirationTime - Date.now();
                // ãƒªãƒ³ã‚¯ãŒæœŸé™åˆ‡ã‚Œã«ãªã‚‹ç›´å‰ã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆã•ã›ã‚‹ãŸã‚ã®å‡¦ç†ã‚’è¿½åŠ 
                if (remaining <= 3000) { // ä¾‹: æ®‹ã‚Š3ç§’ã§é€æ˜åº¦ã‚’ä¸‹ã’å§‹ã‚ã‚‹
                    linkElement.style.opacity = Math.max(0.2, remaining / 3000);
                }
                timerDisplay.textContent = formatTime(remaining);
            }
        });

        renderPaginationButtons(totalPages);
    }

    function renderPaginationButtons(totalPages) {
        if (paginationContainer) paginationContainer.innerHTML = '';

        if (totalPages <= 1) {
            return;
        }

        for (let i = 1; i <= totalPages; i++) {
            const button = document.createElement('div');
            button.className = 'page-button';
            button.textContent = i;

            if (i === currentPage) {
                button.classList.add('active');
            }

            button.onclick = () => renderPage(i);
            if (paginationContainer) paginationContainer.appendChild(button);
        }
    }

    function createLinkElement(linkData) {
        // â˜… æç”»æ™‚ã«ã¯DOMè¦ç´ ã®textContentã‚’ä½¿ã†ã“ã¨ã§XSSã‚’é˜²ã„ã§ã„ã‚‹ãŒã€
        //    linkData.nameã¯Firestoreã‹ã‚‰æ¥ã¦ã„ã‚‹ãŸã‚ã€sanitizeInputé–¢æ•°ã¯ä¸è¦
        const linkElement = document.createElement('a');
        linkElement.href = linkData.url;
        linkElement.target = "_blank";
        linkElement.dataset.id = linkData.id;

        const nameContainer = document.createElement('span');
        nameContainer.className = 'link-name';

        const nameText = document.createElement('span');
        nameText.textContent = linkData.name; // textContentã§å®‰å…¨ã«è¡¨ç¤º

        const timerDisplay = document.createElement('span');
        timerDisplay.className = 'timer-display';

        nameContainer.appendChild(nameText);
        nameContainer.appendChild(timerDisplay);

        const urlSpan = document.createElement('span');
        urlSpan.className = 'link-url';
        urlSpan.textContent = linkData.url;

        linkElement.appendChild(nameContainer);
        linkElement.appendChild(urlSpan);

        return linkElement;
    }

    /**
     * URLè¿½åŠ ãƒœã‚¿ãƒ³ã®ãƒ¡ã‚¤ãƒ³å‡¦ç† (HTMLã® onclick ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹)
     */
    window.displayUrl = async function() { 
        const urlInput = document.getElementById('urlInput');
        const linkNameInput = document.getElementById('linkNameInput');
        const addButton = document.querySelector('.input-group button');

        const url = urlInput ? urlInput.value.trim() : '';
        let linkName = linkNameInput ? linkNameInput.value.trim() : '';

        if (messageElement) messageElement.style.color = '#555';

        // å‡¦ç†ä¸­ã¯ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
        if (addButton) {
            addButton.disabled = true;
            addButton.textContent = 'å‡¦ç†ä¸­...';
        }

        try {
            // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ (å¤‰æ›´ãªã—)
            if (url === "" && messageElement) {
                messageElement.style.color = '#d32f2f';
                messageElement.textContent = 'âš ï¸ URLã¯å¿…é ˆã§ã™ã€‚å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
                return;
            }
            const MAX_URL_LENGTH = 500;
            if (url.length > MAX_URL_LENGTH && messageElement) {
                messageElement.style.color = '#d32f2f';
                messageElement.textContent = `âš ï¸ URLãŒé•·ã™ãã¾ã™ã€‚ï¼ˆæœ€å¤§${MAX_URL_LENGTH}æ–‡å­—ã¾ã§ã§ã™ã€‚ï¼‰`;
                return;
            }
            const BLACKLISTED_DOMAINS = ['bit.ly', 't.co', 'tinyurl.com', 'is.gd', 'goo.gl', 'rb.gy', 'ow.ly'];
            const isBlacklisted = BLACKLISTED_DOMAINS.some(domain => url.includes(domain));
            if (isBlacklisted && messageElement) {
                messageElement.style.color = '#d32f2f';
                messageElement.textContent = 'âš ï¸ çŸ­ç¸®URLã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ã®ãƒªãƒ³ã‚¯ã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ç†ç”±ã«ã‚ˆã‚Šè¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å…ƒã®URLã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚';
                return;
            }
            // URLãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã‚ˆã‚Šå³å¯†ã«ãƒã‚§ãƒƒã‚¯ï¼ˆhttps://ã‚’æ¨å¥¨ã€javascript:ãªã©ã‚’ãƒ–ãƒ­ãƒƒã‚¯ï¼‰
            const urlPattern = /^https?:\/\/[a-z0-9\-\.]+\.[a-z]{2,}/i; 
            if (!urlPattern.test(url) && messageElement) {
                messageElement.style.color = '#d32f2f';
                messageElement.textContent = 'âš ï¸ URLã¯ **http://** ã¾ãŸã¯ **https://** ã§å§‹ã¾ã‚Šã€æœ‰åŠ¹ãªãƒ‰ãƒ¡ã‚¤ãƒ³å½¢å¼ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚';
                return;
            }

            // URLã®é‡è¤‡ãƒã‚§ãƒƒã‚¯ (å¤‰æ›´ãªã—)
            const q = query(collection(db, "links"), where("url", "==", url), limit(1));
            const snapshot = await getDocs(q); 

            if (!snapshot.empty && messageElement) {
                messageElement.style.color = '#d32f2f';
                messageElement.textContent = 'ğŸš« ã“ã®URLã¯**æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™**ã€‚åˆ¥ã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
                if (urlInput) urlInput.value = '';
                if (linkNameInput) linkNameInput.value = '';
                return;
            }

            // ãƒªãƒ³ã‚¯åã®å‡¦ç†
            if (linkName === "") {
                linkName = "ğŸ”— ãƒªãƒ³ã‚¯";
            }
            
            // â˜…â˜…â˜… ãƒªãƒ³ã‚¯åã«ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã‚’é©ç”¨ï¼ˆXSSå¯¾ç­–ï¼‰â˜…â˜…â˜…
            const sanitizedLinkName = sanitizeInput(linkName);

            const startTime = Date.now();
            const expirationTime = startTime + DELETE_DELAY_MS;

            // Firestoreã«ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€
            await addDoc(collection(db, "links"), {
                url: url,
                name: sanitizedLinkName, // â˜… ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã—ãŸãƒªãƒ³ã‚¯åã‚’ä½¿ç”¨
                expirationTime: expirationTime,
                timestamp: startTime
            });

            if (messageElement) messageElement.textContent = `âœ… ãƒªãƒ³ã‚¯ã€Œ${sanitizedLinkName}ã€ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚`;

        } catch (error) {
            console.error("ãƒªãƒ³ã‚¯å‡¦ç†ã‚¨ãƒ©ãƒ¼: ", error);
            if (messageElement) {
                messageElement.style.color = '#d32f2f';
                messageElement.textContent = 'ğŸ”´ ãƒªãƒ³ã‚¯ã®å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚èªè¨¼ã¾ãŸã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
            }
        } finally {
            // å‡¦ç†çµ‚äº†å¾Œã«å¿…ãšãƒœã‚¿ãƒ³ã‚’å†æœ‰åŠ¹åŒ–
            if (addButton) {
                addButton.disabled = false;
                addButton.textContent = 'è¿½åŠ ';
            }
            if (urlInput) urlInput.value = '';
            if (linkNameInput) linkNameInput.value = '';
            if (linkNameInput) linkNameInput.focus();
        }
    }


    function formatTime(ms) {
        const totalSeconds = Math.max(0, Math.floor(ms / 1000));
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;

        const paddedSeconds = String(seconds).padStart(2, '0');

        return `${minutes}:${paddedSeconds}`;
    }

    function startFirestoreListener() {
         const linksCollection = collection(db, "links"); 
         
         const q = query(
             linksCollection, 
             orderBy("timestamp", "desc"), 
             limit(100) 
         );

         onSnapshot(q, (snapshot) => {
             // å–å¾—ã—ãŸå…¨ãƒªãƒ³ã‚¯ã‹ã‚‰ã€æœ‰åŠ¹æœŸé™å†…ã®ã‚‚ã®ã ã‘ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
             allLinks = snapshot.docs.map(doc => ({
                 id: doc.id,
                 ...doc.data()
             })).filter(link => link.expirationTime > Date.now()); 
             
             renderPage(currentPage);
         }, error => {
             console.error("Firestoreã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ã‚¨ãƒ©ãƒ¼: ", error);
         });
    }

    // 1ç§’ã”ã¨ã«ã‚¿ã‚¤ãƒãƒ¼ã¨ãƒšãƒ¼ã‚¸ã‚’æ›´æ–° (å¤‰æ›´ãªã—)
    setInterval(() => {
        renderPage(currentPage); 
    }, 1000);

    // DOMContentLoadedã§ãƒªã‚¹ãƒŠãƒ¼ã¨ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¡ãƒ¢ã®èª­ã¿è¾¼ã¿ã‚’è¡Œã†ï¼ˆâ˜…åŒ¿åã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚’è¿½åŠ ï¼‰
    document.addEventListener('DOMContentLoaded', async () => {
        
        // â˜…â˜…â˜… åŒ¿åã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚’å®Ÿè¡Œ â˜…â˜…â˜…
        try {
            await signInAnonymously(auth);
            console.log("åŒ¿åã‚µã‚¤ãƒ³ã‚¤ãƒ³ã«æˆåŠŸã—ã¾ã—ãŸã€‚ã“ã®çŠ¶æ…‹ã§æ›¸ãè¾¼ã¿ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚");
            if (messageElement) messageElement.textContent = 'âœ… ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šå®Œäº†ã€‚ãƒªãƒ³ã‚¯ã‚’è¿½åŠ ã§ãã¾ã™ã€‚';
        } catch (error) {
            console.error("åŒ¿åã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼: ", error);
            if (messageElement) {
                messageElement.style.color = '#d32f2f';
                messageElement.textContent = 'ğŸ”´ ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šã‚¨ãƒ©ãƒ¼ã€‚ãƒªãƒ³ã‚¯ã®è¿½åŠ ã¯ã§ãã¾ã›ã‚“ã€‚';
            }
        }
        
        startFirestoreListener();
        loadLocalMemo();
    });
</script>





            
</body>
</html>














